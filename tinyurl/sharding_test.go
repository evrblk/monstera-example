package tinyurl

import (
	"github.com/stretchr/testify/require"
	"testing"
)

func TestShardByUser(t *testing.T) {
	require := require.New(t)

	shardKeys := []struct {
		userId   uint32
		shardKey []byte
	}{
		{2573051375, []byte{189, 202, 217, 47}},
		{1298841629, []byte{75, 44, 77, 213}},
		{3875800613, []byte{94, 125, 164, 225}},
		{814431840, []byte{197, 238, 147, 24}},
		{2747098634, []byte{209, 220, 82, 220}},
		{2958640900, []byte{250, 66, 128, 235}},
		{3051499374, []byte{49, 241, 129, 172}},
		{3032387137, []byte{60, 94, 138, 165}},
		{2065052263, []byte{38, 65, 209, 11}},
		{338206401, []byte{214, 221, 141, 57}},
		{3657818294, []byte{95, 122, 221, 26}},
		{1044506485, []byte{34, 242, 124, 253}},
		{2782633844, []byte{124, 157, 147, 81}},
		{2389351250, []byte{62, 61, 224, 204}},
		{3477147455, []byte{183, 49, 32, 62}},
		{2180771480, []byte{179, 211, 35, 149}},
		{2881500757, []byte{59, 11, 92, 49}},
		{870306257, []byte{62, 229, 239, 100}},
		{2432005556, []byte{215, 21, 135, 7}},
		{1632735560, []byte{240, 26, 178, 67}},
		{1826047982, []byte{140, 255, 181, 240}},
		{371329972, []byte{173, 222, 104, 60}},
		{2407464741, []byte{32, 13, 160, 213}},
		{1602592429, []byte{134, 30, 143, 212}},
		{348879751, []byte{215, 102, 177, 137}},
		{1874203767, []byte{215, 213, 58, 98}},
		{324483880, []byte{216, 17, 58, 154}},
		{2065691884, []byte{253, 82, 124, 68}},
		{816003017, []byte{139, 136, 244, 109}},
		{1368494275, []byte{246, 49, 252, 82}},
		{569638603, []byte{103, 146, 196, 127}},
		{3005969297, []byte{37, 90, 253, 170}},
		{2355981720, []byte{228, 154, 38, 178}},
		{2301717707, []byte{38, 64, 225, 154}},
		{955929780, []byte{31, 44, 235, 240}},
		{3430094064, []byte{63, 158, 249, 160}},
		{150127609, []byte{210, 247, 56, 117}},
		{1611671413, []byte{234, 246, 186, 236}},
		{602485221, []byte{49, 183, 182, 77}},
		{1923886463, []byte{18, 9, 254, 53}},
		{273155578, []byte{68, 11, 58, 215}},
		{713498570, []byte{55, 152, 31, 225}},
		{3134286394, []byte{95, 155, 166, 62}},
		{2536399084, []byte{197, 21, 214, 131}},
		{3110963282, []byte{84, 170, 27, 151}},
		{882777513, []byte{105, 222, 33, 96}},
		{1411598350, []byte{83, 122, 84, 220}},
		{1956687811, []byte{237, 65, 194, 152}},
		{1208625928, []byte{65, 33, 97, 170}},
		{1488799420, []byte{39, 255, 53, 245}},
		{1678049567, []byte{17, 234, 135, 139}},
		{1386393965, []byte{237, 71, 157, 120}},
		{1089284923, []byte{150, 30, 53, 158}},
		{2312508520, []byte{130, 52, 39, 188}},
		{2675671879, []byte{50, 124, 247, 233}},
		{3900838047, []byte{57, 178, 201, 113}},
		{3625646473, []byte{75, 167, 49, 145}},
		{172341718, []byte{236, 199, 176, 21}},
		{1814771551, []byte{227, 157, 236, 119}},
		{2257996365, []byte{207, 105, 222, 230}},
		{3730296283, []byte{118, 24, 204, 88}},
		{2544118304, []byte{47, 93, 237, 246}},
		{3301421991, []byte{139, 242, 237, 171}},
		{984881211, []byte{177, 137, 100, 226}},
		{2750739058, []byte{189, 246, 101, 102}},
		{1331122957, []byte{5, 145, 30, 65}},
		{2332849298, []byte{185, 127, 241, 49}},
		{2167558584, []byte{169, 84, 186, 36}},
		{3269688897, []byte{44, 198, 63, 238}},
		{2703060337, []byte{151, 67, 165, 51}},
		{4013455748, []byte{246, 158, 219, 219}},
		{286020261, []byte{233, 157, 80, 138}},
		{1946873702, []byte{179, 211, 237, 88}},
		{2680698434, []byte{80, 165, 186, 104}},
		{4071887559, []byte{23, 135, 30, 71}},
		{2044027627, []byte{9, 181, 250, 29}},
		{1332098641, []byte{190, 134, 88, 146}},
		{3235150058, []byte{173, 236, 2, 201}},
		{3731378088, []byte{35, 20, 48, 125}},
		{942139781, []byte{112, 128, 69, 62}},
		{3555550757, []byte{64, 180, 42, 184}},
		{2239093730, []byte{122, 14, 228, 116}},
		{826764114, []byte{45, 213, 24, 164}},
		{3897696223, []byte{71, 239, 179, 195}},
		{16200541, []byte{98, 73, 142, 27}},
		{3407444208, []byte{186, 253, 48, 241}},
		{2914853062, []byte{251, 14, 82, 85}},
		{416989555, []byte{243, 147, 225, 55}},
		{757787634, []byte{137, 76, 18, 29}},
		{162055706, []byte{107, 60, 151, 102}},
		{1323201088, []byte{127, 222, 23, 78}},
		{32300289, []byte{47, 105, 73, 132}},
		{3712368358, []byte{54, 19, 216, 70}},
		{3493984301, []byte{45, 34, 123, 216}},
		{2138275057, []byte{202, 21, 138, 81}},
		{1059734022, []byte{213, 32, 184, 254}},
		{1894776840, []byte{228, 112, 158, 20}},
		{4150836526, []byte{121, 127, 169, 9}},
		{3632522920, []byte{214, 248, 255, 117}},
		{3617035740, []byte{248, 160, 118, 184}},
	}

	for _, d := range shardKeys {
		actual := shardByUser(d.userId)
		require.Equal(d.shardKey, actual)
	}
}
